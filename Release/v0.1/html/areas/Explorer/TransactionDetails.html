<div class="TransactionDetails center" >
    <div class="panel panel-default">

        <div class="panel-heading">CHC txid:
            <span class="transactionid"></span>
        </div>

        <div class="panel-body">
            <div class="row">
                <div class="col-xs-2">
                    <div>
                        Confirmations
                    </div>
                    <div class="block-confirmations">

                    </div>
                </div>

                <div class="col-xs-6">
                    <div>
                        Block Hash
                    </div>
                    <div class="block-hash">

                    </div>
                </div>
                <div class="col-xs-2">
                    <div>
                        Timestamp
                    </div>
                    <div class="block-timestamp">

                    </div>
                </div>

                <div class="col-xs-2">
                    <div>

                    </div>
                    <div class="view-block">

                    </div>
                </div>

            </div>

        </div>
    </div>


    <div class="row">

        <div class="col-lg-6">
            <div class="panel panel-default TransactionInputAddressList">

                <div class="panel-heading">Inputs Addresses</div>

                <div class="panel-body">
                    <div class="row header">
                        <div class="col-xs-6 transaction-input-address">
                            Address
                        </div>
                        <div class="col-xs-6 transaction-input-amount">
                            Amount (CHC)
                        </div>
                    </div>

                    <div class="rows">

                    </div>

                </div>
            </div>
        </div>
        
    </div>

</div>

<script>
    $(function () {

        var transactionDetailsEl = $(".TransactionDetails");
        transactionDetailsEl.on("showArea", function (event, transactionId) {
            transactionDetailsEl.show();
            loadTransaction(transactionId);
        });
        transactionDetailsEl.on("hideAll", function () {
            transactionDetailsEl.hide();
        });


        
        var transactionIdEl = transactionDetailsEl.find(".transactionid");
        var blockConfirmationEl = transactionDetailsEl.find(".block-confirmations");
        var blockHashEl = transactionDetailsEl.find(".block-hash");
        var timestampHashEl = transactionDetailsEl.find(".block-timestamp");


        var inputAddressListEl = transactionDetailsEl.find(".TransactionInputAddressList");
        var inputAddressListRowsEl = inputAddressListEl.find(".rows");
        var inputAddressListRowTemplateEl = inputAddressListEl.find(".header").clone().removeClass("header");

        var recipientListEl = transactionDetailsEl.find(".TransactionRecipientList");
        var recipientListRowsEl = recipientListEl.find(".rows");
        var recipientListRowTemplateEl = recipientListEl.find(".header").clone().removeClass("header");

        var loadTransaction = function (tranactionId) {
            $.get(chaincoinBlockchainApiUrl + "/getTransaction?txid=" + tranactionId).then(function (transaction) {

                var promies = [
                    $.get(chaincoinBlockchainApiUrl + "/getBlock?hash=" + transaction.blockhash)
                ];

                transaction.vin.forEach(function (vin) {
                    if (vin.coinbase == null){
                        promies.push($.get(chaincoinBlockchainApiUrl + "/getTransaction?txid=" + vin.txid));
                    }
                });


                $.when.apply($, promies).then(function () {
                    var block = promies.length > 1 ? arguments[0][0] : arguments[0];

                    var vinTransactions = []
                    for(var i = 1; i < arguments.length; i++)
                    {
                        vinTransactions.push(arguments[i][0]);
                    } 


                    transactionIdEl.text(transaction.txid);
                    blockConfirmationEl.text(block.confirmations);
                    blockHashEl.text(block.hash);

                    var timestamp = new Date(block.time * 1000);
                    timestampHashEl.text(timestamp.toLocaleTimeString() + " " + timestamp.toLocaleDateString());

                    inputAddressListRowsEl.empty();
                    transaction.vin.forEach(function (vin,vinIndex) {
                        var rowEl = inputAddressListRowTemplateEl.clone().appendTo(inputAddressListRowsEl);
                        if (vin.coinbase != null){
                            rowEl.find(".transaction-input-address").text("New Coins");
                            rowEl.find(".transaction-input-amount").text("");
                        }
                        else
                        {
                            rowEl.find(".transaction-input-address").text(vinTransactions[vinIndex].vout[vin.vout].scriptPubKey.addresses[0]);
                            rowEl.find(".transaction-input-amount").text(vinTransactions[vinIndex].vout[vin.vout].value);
                        }

                    });

                    recipientListRowsEl.empty();
                    transaction.vout.forEach(function (vout) {
                        if (vout.value == 0) return;
                        var rowEl = recipientListRowTemplateEl.clone().appendTo(recipientListRowsEl);
                        rowEl.find(".transaction-recipients-address").text(vout.scriptPubKey.addresses[0]);
                        rowEl.find(".transaction-recipients-amount").text(vout.value);
                    })



                });
            });
        }

    });
</script>