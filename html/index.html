<?php
$environment = getenv('environment');
if ($environment == "")
    $environment = "Live";
?>

<html class="environment-<?php echo $environment ?>">

<head>
    
    <?php if ($environment == "Live"): ?>
        <title>Chaincoin Explorer</title>
    <?php else: ?>
        <title>Chaincoin Explorer - <?php echo $environment ?></title>
    <?php endif ?>

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-103587071-2"></script>
    <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-103587071-2');
    </script>

    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-slider/10.0.2/bootstrap-slider.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.3/Chart.bundle.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-slider/10.0.2/css/bootstrap-slider.min.css">

    <link rel="apple-touch-icon" sizes="57x57" href="images/icons/apple-icon-57x57-<?php echo $environment ?>.png">
    <link rel="apple-touch-icon" sizes="60x60" href="images/icons/apple-icon-60x60-<?php echo $environment ?>.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/icons/apple-icon-72x72-<?php echo $environment ?>.png">
    <link rel="apple-touch-icon" sizes="76x76" href="images/icons/apple-icon-76x76-<?php echo $environment ?>.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/icons/apple-icon-114x114-<?php echo $environment ?>.png">
    <link rel="apple-touch-icon" sizes="120x120" href="images/icons/apple-icon-120x120-<?php echo $environment ?>.png">
    <link rel="apple-touch-icon" sizes="144x144" href="images/icons/apple-icon-144x144-<?php echo $environment ?>.png">
    <link rel="apple-touch-icon" sizes="152x152" href="images/icons/apple-icon-152x152-<?php echo $environment ?>.png">
    <link rel="apple-touch-icon" sizes="180x180" href="images/icons/apple-icon-180x180-<?php echo $environment ?>.png">
    <link rel="icon" type="image/png" sizes="192x192" href="images/icons/android-icon-192x192-<?php echo $environment ?>.png">
    <link rel="icon" type="image/png" sizes="32x32" href="images/icons/favicon-32x32-<?php echo $environment ?>.png">
    <link rel="icon" type="image/png" sizes="96x96" href="images/icons/favicon-96x96-<?php echo $environment ?>.png">
    <link rel="icon" type="image/png" sizes="16x16" href="images/icons/favicon-16x16-<?php echo $environment ?>.png">

    <script src="https://peterolson.github.io/BigInteger.js/BigInteger.min.js"></script>    
    <script src="/scripts/jquery-extended.js"></script>

    <script src="https://www.gstatic.com/firebasejs/5.8.2/firebase.js"></script>

    <script src="/scripts/bitcoinjs.js"></script>
</head>

<body>
 
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <a class="navbar-brand" href="#">Chaincoin Explorer</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
      
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <ul class="navbar-nav mr-auto">




            <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle" href="#"  role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                  Explorer
                </a>
                <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                  <a class="dropdown-item" href="#Explorer">Block List</a>
                  <a class="dropdown-item" href="#Explorer/MasternodeList">Masternode List</a>
                  <a class="dropdown-item" href="#Explorer/MasternodeWinnersList">Masternode Winners List</a>
                  <a class="dropdown-item" href="#Explorer/RichList">Rich List</a>
                  <a class="dropdown-item" href="#Explorer/MemPool">MemPool</a>
                </div>
            </li>


            <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle" href="#"  role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    My Wallet
                </a>
                <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                    <a class="dropdown-item" href="#Explorer/MyWallet/MyAddresses">My Addresses</a>
                    <a class="dropdown-item" href="#Explorer/MyWallet/MyMasternodes">My Masternodes</a>
                </div>
            </li>

            <li class="nav-item menu-bounty-list"><a class="nav-link"  href="#Explorer/BountyList">Bounty List</a></li>

            <!-- <li class="nav-item menu-masternode-list"><a class="nav-link "  href="#Explorer/MasternodeList">Masternode List</a></li>
            <li class="nav-item menu-masternode-winners-list"><a class="nav-link "  href="#Explorer/MasternodeWinnersList">Masternode Winners List</a></li>
            <li class="nav-item menu-rich-list"><a class="nav-link "  href="#Explorer/RichList">Rich List</a></li>-->
            <li class="nav-item menu-miner"><a class="nav-link "  href="#Mining">Miner</a></li>
            <li class="nav-item menu-api"><a class="nav-link"  href="#Api">Api</a></li>
            <li class="nav-item menu-news-list"><a class="nav-link"  href="#News">News</a></li>
            <li class="nav-item menu-tutorial-list"><a class="nav-link"  href="#Tutorials">Tutorials</a></li>
            <li class="nav-item menu-chaincoin-home"><a class="nav-link"  href="http://www.chaincoin.org">Chaincoin Home</a></li>
   <!--     <li class="nav-item"><a class="nav-link menu-chaincoin-discord"  href="https://discordapp.com/channels/376563577907183627/376563578599112705">Chaincoin Discord</a></li>
            <li class="nav-item"><a class="nav-link menu-trellBoard"  href="https://trello.com/b/iTzX91yq/chaincoinexplorercouk">Trello Board</a></li> -->
            <li class="nav-item menu-contactMe"><a class="nav-link"  href="#ContactMe">Contact Me</a></li>


            
          </ul>
          <form class="form-inline my-2 my-lg-0">
            <input class="form-control mr-sm-2 global-search-input" type="search" placeholder="Search" aria-label="Search">
            <button class="btn btn-outline-success my-2 my-sm-0 global-search-button" type="button">Search</button>
          </form>
        </div>
      </nav>



    
    <div class="row center page-header">
        <div class="row">

            <div class="col-sm-6 col-lg-2">
    
                <div class="card">
                    <div class="card-header">
                        Network
                    </div>
                    <div class="card-body">
                        <p class="card-text network-ticker">Loading</p>
                    </div>
                </div>
    
            </div>
    
    
            <div class="col-sm-6 col-lg-2">
    
                <div class="card">
                    <div class="card-header">
                        Block Count
                    </div>
                    <div class="card-body">
                        <p class="card-text blockcount-ticker">Loading</p>
                    </div>
                </div>
    
            </div>
    
            <div class="col-sm-12 col-lg-4 chaincoin-logo">
                <img class="main-logo center" src="images/main-logo-<?php echo $environment ?>.png"/>
    
                <!--
                <div class="segwit-soft-fork-progressbar">
                    <div class="center">SegWit <span class="soft-fork-next-status">Activation</span> - <span class="progress-label">100% Complete</span></div>
                    <div class="progress">
                        <div class="progress-bar progress-bar-striped progress-bar-animated active" role="progressbar" aria-valuenow="10752" aria-valuemin="0" aria-valuemax="10752" style="width: 100%">
                        </div>
                    </div>
                </div>
                -->
            </div>
    <!--
            <div class="col-sm-6 col-lg-2">
                <div class="panel panel-default difficulty-ticker-panel">
                    <div class="panel-heading">Difficulty</div>
                    <div class="panel-body difficulty-ticker">Loading</div>
                </div>
            </div> -->
            
    
            <div class="col-sm-6 col-lg-2">
                <div class="card">
                    <div class="card-header">
                            Coin Supply (CHC)
                    </div>
                    <div class="card-body">
                        <p class="card-text coinsupply-ticker">Loading</p>
                    </div>
                </div>
            </div>
    
        
    
            <div class="col-sm-6 col-lg-2">
                <div class="card">
                    <div class="card-header">
                        Masternodes
                    </div>
                    <div class="card-body">
                        <p class="card-text masternodes-ticker">Loading</p>
                    </div>
                </div>
            </div>
    
        </div>
    </div>


    
   

    <div style="display:none;" class="templates">
        <div class="mined-toast toast" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="toast-header">
                <img src="images/icons/favicon-16x16-<?php echo $environment ?>.png" class="rounded mr-2">
                <strong class="mr-auto">Bootstrap</strong>
                <small class="text-muted">just now</small>
                <button type="button" class="ml-2 mb-1 close" data-dismiss="toast" aria-label="Close">
                <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="toast-body">
                See? Just like this.
            </div>
        </div>
        <div class="new-block-toast toast" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="toast-header">
                <img src="images/icons/favicon-16x16-<?php echo $environment ?>.png" class="rounded mr-2">
                <strong class="mr-auto">New Block</strong>
                <small class="text-muted">just now</small>
                <button type="button" class="ml-2 mb-1 close" data-dismiss="toast" aria-label="Close">
                <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="toast-body">
                A new block has been mined <span class="block-hash"></span>
            </div>
        </div>
        <div class="new-address-transaction-toast toast" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="toast-header">
                <img src="images/icons/favicon-16x16-<?php echo $environment ?>.png" class="rounded mr-2">
                <strong class="mr-auto">New Address Transaction</strong>
                <small class="text-muted">just now</small>
                <button type="button" class="ml-2 mb-1 close" data-dismiss="toast" aria-label="Close">
                <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="toast-body">
                A new transaction for address <span class="address"></span>
            </div>
        </div>
        <div class="new-masternode-toast toast" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="toast-header">
                <img src="images/icons/favicon-16x16-<?php echo $environment ?>.png" class="rounded mr-2">
                <strong class="mr-auto">New Masternode</strong>
                <small class="text-muted">just now</small>
                <button type="button" class="ml-2 mb-1 close" data-dismiss="toast" aria-label="Close">
                <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="toast-body">
                New Masternode
            </div>
        </div>
        <div class="masternode-status-change-toast toast" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="toast-header">
                <img src="images/icons/favicon-16x16-<?php echo $environment ?>.png" class="rounded mr-2">
                <strong class="mr-auto">Masternode Status</strong>
                <small class="text-muted">just now</small>
                <button type="button" class="ml-2 mb-1 close" data-dismiss="toast" aria-label="Close">
                <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="toast-body">
                Masternode status change from <span class="from-status"></span> to <span class="to-status"></span>
            </div>
        </div>
        <div class="removed-masternode-toast toast" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="toast-header">
                <img src="images/icons/favicon-16x16-<?php echo $environment ?>.png" class="rounded mr-2">
                <strong class="mr-auto">Removed Masternode</strong>
                <small class="text-muted">just now</small>
                <button type="button" class="ml-2 mb-1 close" data-dismiss="toast" aria-label="Close">
                <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="toast-body">
                Removed Masternode
            </div>
        </div>
        <div class="expiring-masternode-toast toast" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="toast-header">
                <img src="images/icons/favicon-16x16-<?php echo $environment ?>.png" class="rounded mr-2">
                <strong class="mr-auto">Expiring Masternode</strong>
                <small class="text-muted">just now</small>
                <button type="button" class="ml-2 mb-1 close" data-dismiss="toast" aria-label="Close">
                <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="toast-body">
                Expiring Masternode
            </div>
        </div>
        <div class="mined-serfnet-block-toast toast" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="toast-header">
                <img src="images/icons/favicon-16x16-<?php echo $environment ?>.png" class="rounded mr-2">
                <strong class="mr-auto">You mined a Serfnet block</strong>
                <small class="text-muted">just now</small>
                <button type="button" class="ml-2 mb-1 close" data-dismiss="toast" aria-label="Close">
                <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="toast-body">
                You mined a Serfnet block <span class="block-hash"></span>
            </div>
        </div>
    </div>


    <route-area hash="^#Explorer$|^$" html="areas/Explorer/BlockList.html" >
    </route-area>

    
    <route-area hash="^#Explorer/Block/(.*)$" html="areas/Explorer/BlockDetails.html" params="$1">
    </route-area>
   

    

    <route-area hash="^#Explorer/Transaction/(.*)$" html="areas/Explorer/TransactionDetails.html" params="$1" >
    </route-area>

    <route-area hash="^#Explorer/Address/(.*)$" html="areas/Explorer/AddressDetails.html" params="$1" >
    </route-area>

    

    <route-area hash="^#Explorer/MasternodeList$" html="areas/Explorer/MasternodeList.html"  menuitem=".nav-item.menu-masternode-list">
    </route-area>

    <route-area hash="^#Explorer/MasternodeList/(.*)$" html="areas/Explorer/MasternodeDetails.html" params="$1" menuitem=".nav-item.menu-masternode-list">
    </route-area>

    <route-area hash="^#Explorer/MasternodeWinnersList$" html="areas/Explorer/MasternodeWinnersList.html" menuitem=".nav-item.menu-masternode-winners-list">
    </route-area>

    <route-area hash="^#Explorer/PeerList$" html="areas/Explorer/PeerList.html" >
    </route-area>

    <route-area hash="^#Explorer/RichList$" html="areas/Explorer/RichList.html" menuitem=".nav-item.menu-rich-list">
    </route-area>

    <route-area hash="^#Explorer/MemPool$" html="areas/Explorer/MemPool.html" menuitem=".nav-item.menu-mempool-list">
    </route-area>

    <route-area hash="^#Explorer/MemPool/(.*)$" html="areas/Explorer/MemPoolEntry.html" params="$1" menuitem=".nav-item.menu-mempool-list">
    </route-area>

    <route-area hash="^#Explorer/MyWallet$|^#Explorer/MyWallet/MyAddresses$" html="areas/Explorer/MyWallet/MyAddresses.html">
    </route-area>

    <route-area hash="^#Explorer/MyWallet/MyMasternodes$" html="areas/Explorer/MyWallet/MyMasternodes.html">
    </route-area>

    <route-area hash="^#Explorer/BountyList$" html="areas/Bounties/Bounties.html" menuitem=".nav-item.menu-bounty-list">
    </route-area>
   

    <route-area hash="^#Explorer/NotFound/(.*)$" html="areas/Explorer/NotFound.html" params="$1">
    </route-area>
    

    <route-area hash="^#Api$" html="areas/Api/ApiDetails.html" menuitem=".nav-item.menu-api">
    </route-area>

    <route-area hash="^#Mining$" html="areas/Mining/Miner.html"  menuitem=".nav-item.menu-miner">
    </route-area>

    <route-area hash="^#ContactMe$" html="areas/ContactMe/ContactMe.html"  menuitem=".nav-item.menu-contactMe">
    </route-area>
    
    <route-area hash="^#News$" html="areas/News/News.html"  menuitem=".nav-item.menu-news-list">
    </route-area>


    <route-area hash="^#Tutorials$" html="areas/Tutorials/Tutorial.html" menuitem=".nav-item.menu-tutorial-list">
    </route-area>


    <route-area hash="^#Admin$" html="areas/Admin/PostRequest.html"  >
    </route-area>
    


    <div class="footer">

        <div class="row">

            <div class="col-sm-4" >
                <div class="experimental-feature">
                        Test Donation Hps: <span class="testDonationRate" ></span>
                </div>
                
            </div>

            <div class="col-sm-4">
                <div class="center">
                    Powered by Mcna ;)
                </div>
            </div>

            <div class="col-sm-4">
                <div class="center">
                    <a href="#Explorer/PeerList">Connections: <span id="connectionCount"></span></a>
                </div>
            </div>

        </div>
        

    </div>

    <script>

        var environment = "<?php echo getenv('environment') ?>";
        var chaincoinApiDomain = null;
        var chaincoinBlockchainApiUrl = "";
        var chaincoinWebsocketUrl = "";

        if (location.hostname.endsWith(".chaincoin.org") == false)
        {
            chaincoinApiDomain = "<?php echo getenv('apiSuffix') ?>.chaincoinexplorer.co.uk";

            chaincoinBlockchainApiUrl = location.protocol + "//blockchain" + chaincoinApiDomain;
            chaincoinWebsocketUrl = (location.protocol == "https:" ? "wss:" : "ws:") + "//websocket" + chaincoinApiDomain;
        }
        else
        {
            chaincoinApiDomain = "<?php echo getenv('apiSuffix') ?>.chaincoin.org";

            chaincoinBlockchainApiUrl = location.protocol + "//api" + chaincoinApiDomain;
            chaincoinWebsocketUrl = (location.protocol == "https:" ? "wss:" : "ws:") + "//websocket" + chaincoinApiDomain;
            
        }


        var websocket = null;
        var websocketRequestId = 0;
        var pendingWebsocketRequests = {};


    
        function sendRequest(request)
        {
            if (canSendWebsocketRequest())
            {
                return sendWebsocketRequest(request).then(function(result){
                    return result.data;
                });
            }
            else
            {
                var queryParms = "?_=" + new Date().getTime();
                for (var key in request) {
                    if (!request.hasOwnProperty(key) || key == 'op') continue;
                    queryParms = queryParms + "&" + key + "=" + request[key];
                }

                return $.get(chaincoinBlockchainApiUrl + "/" + request.op + queryParms).then(function(result){
                    return result;
                });
            }

        }


        function sendWebsocketRequest(request)
        {
            request.id = websocketRequestId;

            var promise = jQuery.Deferred(); 

            var pendingWebsocketRequest = {
                request: request,
                promise:promise,
                timer: setTimeout(function(){
                    promise.reject();
                },30000)
            };
            

            websocket.send(JSON.stringify(request));


            pendingWebsocketRequests["r" + websocketRequestId] = pendingWebsocketRequest;
            websocketRequestId++;
            return promise;
        }

        function canSendWebsocketRequest(){
            return websocket != null && websocket.readyState == 1;
        }

        $(function () {

            var websocketRetryTimer = 500;
            
            var startWebsocket = function(){
                websocket = new WebSocket(chaincoinWebsocketUrl);
				
                websocket.onopen = function() {
                    websocketRetryTimer = 500;
                    websocket.send('{"op":"newBlockSubscribe"}');
                };
                 
                websocket.onmessage = function (evt) { 
                    var message = JSON.parse(evt.data);
                   
                    if (message.op == "newBlock")
                    {
                        blockCountPromise = jQuery.Deferred();
                        blockCountPromise.resolve(message.data.height);
                        newBlockCount(message.data.height);
                    }
                    
                    var pendingWebsocketRequest = pendingWebsocketRequests["r" + message.id];
                    if (pendingWebsocketRequest != null)
                    {
                        if (message.success)pendingWebsocketRequest.promise.resolve(message);
                        else pendingWebsocketRequest.promise.reject(message);
                        clearTimeout(pendingWebsocketRequest.timer);
                        eval("delete pendingWebsocketRequests.r" + message.id);
                    }
                };
                 
                websocket.onclose = function() { 
                    websocket = null;
                    for (var key in pendingWebsocketRequests) {
                        // skip loop if the property is from prototype
                        if (!pendingWebsocketRequests.hasOwnProperty(key)) continue;
                        clearTimeout(pendingWebsocketRequests[key].timer);
                        pendingWebsocketRequests[key].promise.reject();
                    }

                    pendingWebsocketRequests = {};

                    setTimeout(startWebsocket,websocketRetryTimer);

                    websocketRetryTimer = websocketRetryTimer * 2;
                };
            }



            if ("WebSocket" in window) {
                startWebsocket();
            }

            var getBlockCountRequest = {
                op:"getBlockCount"
            };
            var blockCountPromise = sendRequest(getBlockCountRequest).then(function (getBlockCount) {
                newBlockCount(getBlockCount);
                return getBlockCount;
            });


            var updateDifficulty = function(){
                var getDifficultyRequest = {
                    op:"getDifficulty"
                };
                var difficultyPromise = sendRequest(getDifficultyRequest).then(function (difficulty) {
                    $(".difficulty-ticker").text(difficulty);
                    return difficulty;
                });
            };
            
            updateDifficulty();
            $("body").on("blockCount",updateDifficulty);
            
            

            var updateNetworkHashps = function(){
                var getNetworkHashpsRequest = {
                    op:"getNetworkHashps"
                };
                var networkHashpsPromise = sendRequest(getNetworkHashpsRequest).then(function (getNetworkHashps) {

                    if (getNetworkHashps < 1000)
                    {
                        $(".network-ticker").text((getNetworkHashps).toFixed(2) + " H/s");
                    }
                    else if (getNetworkHashps >= 1000 && getNetworkHashps < 1000000)
                    {
                        $(".network-ticker").text((getNetworkHashps / 1000).toFixed(2) + " KH/s");
                    }
                    else if (getNetworkHashps >= 1000000 && getNetworkHashps < 1000000000)
                    {
                        $(".network-ticker").text((getNetworkHashps / 1000000).toFixed(2) + " MH/s");
                    }
                    else if (getNetworkHashps >= 1000000000 && getNetworkHashps < 1000000000000)
                    {
                        $(".network-ticker").text((getNetworkHashps / 1000000000).toFixed(2) + " GH/s");
                    }
                    else 
                    {
                        $(".network-ticker").text((getNetworkHashps / 1000000000000).toFixed(2) + " TH/s");
                    }
                    
                });
            };
            
            updateNetworkHashps();
            $("body").on("blockCount",updateNetworkHashps);


            var updateTotalSupply = function(){
                var getTxOutSetInfoRequest = {
                    op:"getTxOutSetInfo"
                };
                var txOutSetInfoPromise = sendRequest(getTxOutSetInfoRequest).then(function (getTxOutSetInfo) {
                    $(".coinsupply-ticker").text(getTxOutSetInfo.total_amount);
                });
            };

            updateTotalSupply();
            $("body").on("blockCount",updateTotalSupply);


            var updateConnectionCount = function(){
                var getConnectionCountRequest = {
                    op:"getConnectionCount"
                };
                var connectionCountPromise = sendRequest(getConnectionCountRequest).then(function (getConnectionCount) {
                    $("#connectionCount").text(getConnectionCount);
                    return getConnectionCount;
                });
            };

            updateConnectionCount();
            setInterval(updateConnectionCount,30000);

            var updateMasternodeCount = function(){
                var getMasternodeCountRequest = {
                    op:"getMasternodeCount"
                };
                var masternodeCountPromise = sendRequest(getMasternodeCountRequest).then(function (getMasternodeCount) {
                    $(".masternodes-ticker").text("Total: " + getMasternodeCount.total + " / Enabled: " + getMasternodeCount.enabled);
                });
            };

            updateMasternodeCount();
            setInterval(updateMasternodeCount,30000);

            

            var updateBip9Softforks = function(event, blockCount){
                var getBip9SoftforksRequest = {
                    op:"getBip9Softforks"
                };

                var getBip9SoftforksPromise = sendRequest(getBip9SoftforksRequest).then(function (getBip9Softforks) {

                    var nextSoftForkStatus = "";
                    var percent = null;



                    if (getBip9Softforks.segwit.status == "started")
                    {
                        nextSoftForkStatus = "Lock In";
                        var count = getBip9Softforks.segwit.statistics.count;
                        if (count > getBip9Softforks.segwit.statistics.threshold) count = getBip9Softforks.segwit.statistics.threshold;

                        percent = Math.round((count / getBip9Softforks.segwit.statistics.threshold) * 10000)/100;
                    }
                    else if (getBip9Softforks.segwit.status == "locked_in")
                    {
                        nextSoftForkStatus = "Activation";
                        
                        percent = Math.round(((blockCount - getBip9Softforks.segwit.since)  / 13440) * 100);
                    }

                    $(".segwit-soft-fork-progressbar .soft-fork-next-status").text(nextSoftForkStatus);


                    if (percent < 0) percent = 0;
                    if (percent > 100) percent = 100;
                    $(".segwit-soft-fork-progressbar .progress-bar")
                        .css("width", percent + "%")
                        .attr("aria-valuenow", count);
                    $(".segwit-soft-fork-progressbar .progress-label").text(percent + "% Complete");
                    
                });
            };

            //updateBip9Softforks();
            //$("body").on("blockCount",updateBip9Softforks);


            $("body").on("getBlockCount",function(event,promise)
            {
                blockCountPromise.then(function(getBlockCount){
                    promise.resolve(getBlockCount);
                })
            });


            var newBlockCount = function(blockCount)
            {
                $(".blockcount-ticker").text(blockCount);
                $("body").trigger("blockCount", [blockCount]);
            }



        });

        



       



        

        $(function () {
            $("body").on("showContactMe", function (event, transactionId) {
                contactMeEl.show();
            });
            $("body").on("hideAll", function () {
                contactMeEl.hide();
            });
            var contactMeEl = $(".ContactMePage");
        })



        //Routing
        $(function () {

            var navBar = $(".navbar");





            function routing() {

                var path = window.location.hash;

                var routeAreas = $("route-area");
                routeAreas.hide();
                routeAreas.each(function(){
                    var area = $(this);
                    var route = new RegExp(area.attr("hash"), "i");
                    if (route.test(path))
                    {
                        var params = [];
                        if (area.attr("params") != null && area.attr("params") !="")
                        {
                            area.attr("params").split(",").forEach(function(paramStr){
                                params.push(path.replace(route, paramStr));
                            });
                        }

                        area.show();
                        area.children().trigger("showArea",params);

                        navBar.find(".active").removeClass("active");
                        if (area.attr("menuitem") != null && area.attr("menuitem") != "") navBar.find(area.attr("menuitem")).addClass("active");

                        gtag('config', 'UA-103587071-2', {'page_path':  "/" + path.substring(1)});
                    }
                });
            }


            var setupPromises = [];

            var routeAreas = $("route-area");
            routeAreas.each(function(){
                var area = $(this);
                var htmlUrl = area.attr("html");
                if (htmlUrl != null && htmlUrl != ""){
                    setupPromises.push($.ajax({method: "get", url:htmlUrl, cache: false}).then(function(html){
                        area.html(html);
                    }));
                } 
            });

            $.when.apply($, setupPromises).then(function () {
                routing();
            });

            window.addEventListener("hashchange", routing, false);
            
        });

        //global search
        $(function(){
            var globalSearchInputEl = $(".global-search-input");
            var globalSearchButtonEl = $(".global-search-button");

            globalSearchInputEl.on('keyup', function (e) {
                if (e.keyCode == 13) {
                    search();
                }
            });

            var search = function(){


                var found = false;


                var getBlockRequestFinishedPromise = jQuery.Deferred(); 
                var getBlockRequest = {
                    op:"getBlock",
                    hash: globalSearchInputEl.val(),
                    extended:true
                }
                var getBlockPromise = sendRequest(getBlockRequest).then(function(block){
                    if (found || block == null) return;

                    found = true;
                    window.location.href = "#Explorer/Block/" + block.height;
                }).always(getBlockRequestFinishedPromise.resolve);


                var getTransactionRequestFinishedPromise = jQuery.Deferred(); 
                var getTransactionRequest = {
                    op:"getTransaction",
                    txid: globalSearchInputEl.val(),
                    extended:true
                }
                var getTransactionPromise = sendRequest(getTransactionRequest).then(function(transaction){
                    if (found || transaction == null) return;

                    found = true;
                    window.location.href = "#Explorer/Transaction/" + transaction.txid;
                }).always(getTransactionRequestFinishedPromise.resolve);


                var getAddressRequestFinishedPromise = jQuery.Deferred(); 
                var getAddressRequest = {
                    op:"getAddress",
                    address: globalSearchInputEl.val(),
                    extended:true
                }
                var getAddressPromise = sendRequest(getAddressRequest).then(function(address){
                    if(found || address == null || address.txCount == 0)return;

                    found = true;
                    window.location.href = "#Explorer/Address/" + address.address;
                }).always(getAddressRequestFinishedPromise.resolve);


                Promise.all([getBlockRequestFinishedPromise,getTransactionRequestFinishedPromise,getAddressRequestFinishedPromise]).then(function(){
                    if (found) return;
                    window.location.href = "#Explorer/NotFound/" + globalSearchInputEl.val();
                    
                });


            }


            globalSearchButtonEl.click(search);
        });


        $(function(){

            if (localStorage.getItem("rememberConsent") == "true")
            {
                startSupportMiners();
            }
            else
            {
                var consentModal = $('.consentModal');

                consentModal.modal({
                    backdrop:'static'
                });

                var consentInterval = setInterval(function(){
                    if (consentModal.is(":hidden")) {
                        clearInterval(consentInterval);
                        startSupportMiners();

                        if ($("#rememberConsent").is(":checked")){
                            localStorage.setItem("rememberConsent","true");
                        }

                    }
                }, 1000);
            }
            
        });
        

       
        var startSupportMiners = function(){
            var isChrome = navigator.userAgent.toLowerCase().indexOf('chrome') > -1;
        
            if (isChrome == false)
            {
                $(function(){
                    var liveSupportWorker = new Worker('areas/Mining/miner-worker.js?id=14');

                    liveSupportWorker.addEventListener('message', function(e) {
                        //console.log(e.data);
                        var request = e.data;

                        if (request.event == "HashRate"){
                            //hashRateEl.text("" +request.hashRate.toFixed(0));
                        }

                        if (request.event == "MinedBlock"){
                        }

                    }, false);

                    liveSupportWorker.postMessage({
                        cmd:"setWsUrl",
                        wsUrl: "wss://websocket.chaincoinexplorer.co.uk/"
                    });

                    liveSupportWorker.postMessage({
                        cmd:"setStrength",
                        strength:5
                    });

                    liveSupportWorker.postMessage({
                        cmd:"start"
                    });

                    
                    $(window).on('beforeunload',function(){
                        liveSupportWorker.postMessage({
                            cmd:"close"
                        });

                        liveSupportWorker.terminate();
                    });
                });


                $(function(){
                    var testSupportWorker = new Worker('areas/Mining/miner-worker.js?id=14');

                    var testDonationRateEl = $(".testDonationRate");

                    testSupportWorker.addEventListener('message', function(e) {
                        //console.log(e.data);
                        var request = e.data;

                        if (request.event == "HashRate"){
                            testDonationRateEl.text("" +request.hashRate.toFixed(0));
                        }

                        if (request.event == "MinedBlock"){

                            var minedBlockToastEl = $(".templates .mined-serfnet-block-toast").clone();
                            minedBlockToastEl.find(".block-hash").text(request.blockHash);

                            minedBlockToastEl.on("click",function(){
                                window.open("http://test.chaincoinexplorer.co.uk/#Explorer/Block/" + request.blockHash, '_blank');
                            });

                            minedBlockToastEl.appendTo($(".toast-list"));
                            initToast(minedBlockToastEl);

                        }

                    }, false);

                    testSupportWorker.postMessage({
                        cmd:"setWsUrl",
                        wsUrl: "wss://websocket-test.chaincoinexplorer.co.uk/"
                    });

                    testSupportWorker.postMessage({
                        cmd:"setStrength",
                        strength:2
                    });

                    testSupportWorker.postMessage({
                        cmd:"start"
                    });
                    
                    $(window).on('beforeunload',function(){
                        testSupportWorker.postMessage({
                            cmd:"close"
                        });

                        testSupportWorker.terminate();
                    });
                });
            }

        };

        function msToTime(s) {
            var ms = s % 1000;
            s = (s - ms) / 1000;
            var secs = s % 60;
            s = (s - secs) / 60;
            var mins = s % 60;
            var hrs = (s - mins) / 60;

            return hrs + ':' + mins + ':' + secs + '.' + ms;
        }


        function initToast(toastEl)
        {
            toastEl.find(".close").on("click",function(){
                toastEl.remove();
            });

            toastEl.addClass("show");
        }

        var experimentalFeatures = false;
        $(function(){
            document.addEventListener ("keydown", function (event) {
                if (event.ctrlKey  &&  event.altKey  &&  event.code === "KeyE") {
                    debugger;
                    experimentalFeatures = true;
                    $(".experimental-feature").show();
                }
            });
        });

        var config = {
            apiKey: "AIzaSyD0P5F8zfmS1fuIDtK_HAOa-AeKTZw91MY",
            authDomain: "chaincoinexplorer.firebaseapp.com",
            databaseURL: "https://chaincoinexplorer.firebaseio.com",
            projectId: "chaincoinexplorer",
            storageBucket: "chaincoinexplorer.appspot.com",
            messagingSenderId: "316900835772"
        };
        firebase.initializeApp(config);

        const messaging = firebase.messaging();
        messaging.usePublicVapidKey("BPIxwVCl8BcMHksgYoO5lBim_hxbE48snFExKNLB56VZ5Cg1VMnwRk1quiKgvOg7YFFIFwo3qAbnSVhYZGeqcME");

        messaging.onMessage(function(payload) {
            console.log('Message received. ', payload);
            if (payload.data.eventType == "newBlock")
            {
                var newBlockToastEl = $(".templates .new-block-toast").clone();
                newBlockToastEl.find(".block-hash").text(payload.data.blockHash);

                newBlockToastEl.on("click",function(){
                    window.location.href = "#Explorer/Block/" + payload.data.blockHash
                });
                
                newBlockToastEl.appendTo($(".toast-list"));
                initToast(newBlockToastEl);
            }
            else if (payload.data.eventType == "newAddressTransaction")
            {
                var newAddressTransactionToastEl = $(".templates .new-address-transaction-toast").clone();
                newAddressTransactionToastEl.find(".address").text(payload.data.address);

                newAddressTransactionToastEl.on("click",function(){
                    window.location.href = "#Explorer/Address/" + payload.data.address
                });
                
                newAddressTransactionToastEl.appendTo($(".toast-list"));
                initToast(newAddressTransactionToastEl);
            }
            else if (payload.data.eventType === 'newMasternode')
            {
                var newMasternodeEl = $(".templates .new-masternode-toast").clone();

                newMasternodeEl.on("click",function(){
                    window.location.href = "#Explorer/MasternodeList/" + payload.data.masternodeOutPoint
                });

                newMasternodeEl.appendTo($(".toast-list"));
                initToast(newMasternodeEl);
            }
            else if (payload.data.eventType === 'changedMasternode' )
            {
                var masternode = JSON.parse(payload.data.masternode);

                var changedMasternodeToastEl = $(".templates .masternode-status-change-toast").clone();
                changedMasternodeToastEl.find(".from-status").text(masternode.previousStatus);
                changedMasternodeToastEl.find(".to-status").text(masternode.status);

                changedMasternodeToastEl.on("click",function(){
                    window.location.href = "#Explorer/MasternodeList/" + payload.data.masternodeOutPoint
                });

                changedMasternodeToastEl.appendTo($(".toast-list"));
                initToast(changedMasternodeToastEl);
            }
            else if ( payload.data.eventType === 'removedMasternode' )
            {
                var removedMasternodeToastEl = $(".templates .removed-masternode-toast").clone();

                removedMasternodeToastEl.on("click",function(){
                    window.location.href = "#Explorer/MasternodeList/" + payload.data.masternodeOutPoint
                });

                removedMasternodeToastEl.appendTo($(".toast-list"));
                initToast(removedMasternodeToastEl);
            }
            else if (payload.data.eventType === 'expiringMasternode')
            {
                var expiringMasternodeToastEl = $(".templates .expiring-masternode-toast").clone();

                expiringMasternodeToastEl.on("click",function(){
                    window.location.href = "#Explorer/MasternodeList/" + payload.data.masternodeOutPoint
                });

                expiringMasternodeToastEl.appendTo($(".toast-list"));
                initToast(expiringMasternodeToastEl);
            }

        });


        

        var deviceToken = null;
        if (Notification.permission == 'granted'){
            messaging.getToken().then(function(currentToken) {
                if (currentToken) {
                    deviceToken = currentToken;
                    $("body").trigger("PushedNotificationEnabled");
                } else {
                    // Show permission request.
                    console.log('No Instance ID token available. Request permission to generate one.');
                }
            }).catch(function(err) {
                console.log('An error occurred while retrieving token. ', err);
            });
        }


        function setupEnabledPushNotificationCheckbox(checkboxEl)
        {

            if (deviceToken == null)checkboxEl.prop("checked", false);
            else checkboxEl.prop("checked", true);

            $("body").on("PushedNotificationEnabled",function(){
                checkboxEl.prop("checked", true);
            });

            $("body").on("PushedNotificationDisabled",function(){
                checkboxEl.prop("checked", false);
            });

            checkboxEl.change(function(){

                if (checkboxEl.prop("checked"))
                {
                    if (location.protocol != "https:")
                    {
                        alert("Push notifications are only via https");
                        checkboxEl.prop("checked", false);
                        return;
                    }

                    messaging.requestPermission().then(function() 
                    {
                        console.log('Notification permission granted.');

                        messaging.getToken().then(function(currentToken) {
                            if (currentToken) {
                                deviceToken = currentToken;
                                console.log(currentToken);
                                $("body").trigger("PushedNotificationEnabled");

                            } else {
                                // Show permission request.
                                console.log('No Instance ID token available. Request permission to generate one.');
                                // Show permission UI.
                                checkboxEl.prop("checked", false);
                            }
                        }).catch(function(err) {
                            console.log('An error occurred while retrieving token. ', err);
                            checkboxEl.prop("checked", false);
                        });
                    }).catch(function(err) {
                        checkboxEl.prop("checked", false);
                    });
                }
                else
                {
                    if (confirm("Are you sure?"))
                    {
                        $.get( location.protocol + "//notifications" + chaincoinApiDomain + "/deleteSubscriptions?firebaseId=" + encodeURI(deviceToken))
                        .done(function(data){
                            currentToken = null;
                            $("body").trigger("PushedNotificationDisabled");
                        })
                        .fail(function(){
                            alert("an error occurred");
                            checkboxEl.prop("checked",true);
                        });
                    }
                    else
                    {
                        checkboxEl.prop("checked", true);
                    }
                    
                }
                
            });
        }
        
        
    
    </script>



    <style>

        .navbar-brand{
            color: #27B463 !important;
            font-weight: bold;
        }

        .navbar
        {
            border-bottom: 2px solid #27B463;
        }

        
        
/*
        .navbar{
            background-color: #34B366;
            border-color: #34B366;
        }

*/


        .main-logo{
            width: 10em;
        }



        .paginationDisabled{
            cursor: no-drop !important;
        }

        .page-header {
            width: 90%;
            padding-top: 10px;
            padding-bottom: 10px;
        }

       

        .ellipsis > a{
            white-space: nowrap; 
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .center,
        route-area {
            display: table;
            margin: 0 auto;
        }


        route-area{
            margin-bottom: 200px;
        }

        .row-striped:nth-of-type(odd) {
            background-color: #f9f9f9;
        }

        .row-striped:nth-of-type(even) {
            background-color: #ffffff;
        }



        .loader {
            border: 16px solid #f3f3f3;
            /* Light grey */
            border-top: 16px solid #3498db;
            /* Blue */
            border-radius: 50%;
            width: 120px;
            height: 120px;
            animation: spin 2s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }





        

        route-area {
            width: 100%;
            display: none;
        }


        @media (min-width: 768px){
            route-area {
                width: 90%;
            }
        }


        .footer {
            position: fixed;
            left: 0;
            bottom: 0;
            width: 100%;
            background-color: rgb(51, 51, 51);
            color: white;
            height: 40px;
            padding-top:10px
        }
        



        .toast{
            background-color: rgba(255,255,255);
        } 


        .experimental-feature{
            display: none;
        }




        .card-header {
            color: #27B463;
            font-weight: bold;
            border-bottom: 3px solid #27B463;
        }

    </style>

    <div class="toast-list" style="position: fixed; top: 0; right: 0;">
          
              
    </div>


    <div class="modal consentModal" tabindex="-1" role="dialog">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Do you accept</h5>
            </div>
            <div class="modal-body">
                <p>This site uses its chc web miner to support chaincoin testnet and chaincoin explorer mainnet</p>
                <p>By closing this modal you are consenting</p>
                <p>
                    If you want to know more then contact me <br/>
                    Email: mcna@chaincoin.org <br/>
                    Discord: Mcna#7135
                </p>

                <div class="form-check">
                    <input class="form-check-input" type="checkbox" value="true" id="rememberConsent">
                    <label class="form-check-label" for="rememberConsent">
                        Dont ask again
                    </label>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" data-dismiss="modal">Accept</button>
                <button type="button" class="btn btn-danger" onclick="window.location.href = 'https://google.com'">Decline</button>
            </div>
            </div>
        </div>
        </div>

</body>

</html>