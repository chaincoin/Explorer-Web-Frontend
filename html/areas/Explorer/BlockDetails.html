<div class="BlockDetails" >


    <div class="card">
        <div class="card-header">
            CHC Block:
            <span class="block-hash"></span>
            <a class="block-json-link">
                <span class="fa fa-info-circle"></span>
            </a>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-lg-2 col-sm-4">
                    <div>
                        Height
                    </div>
                    <div class="block-height">

                    </div>
                </div>

                <div class="col-lg-2 col-sm-4">
                    <div>
                        Difficulty
                    </div>
                    <div class="block-difficulty">

                    </div>
                </div>
                <div class="col-lg-2 col-sm-4">
                    <div>
                        Confirmations
                    </div>
                    <div class="block-confirmations">

                    </div>
                </div>
                <div class="col-lg-2 col-sm-4">
                    <div>
                        Size (kB)
                    </div>
                    <div class="block-size">

                    </div>
                </div>
                <div class="col-lg-2 col-sm-4">
                    <div>
                        Bits
                    </div>
                    <div class="block-bits">

                    </div>
                </div>
                <div class="col-lg-2 col-sm-4">
                    <div>
                        Nonce
                    </div>
                    <div class="block-nonce">

                    </div>
                </div>
                <div class="col-lg-2 col-sm-4">
                    <div>
                        Timestamp
                    </div>
                    <div class="block-timestamp">

                    </div>
                </div>
                <div class="col-lg-2 col-sm-4">
                    <div>
                        Version Bits
                    </div>
                    <div class="block-version-bits">

                    </div>
                </div>

            </div>
        </div>
    </div>



    <div class="panel panel-default TransactionList">

        <div class="card">
            <div class="card-header">
                Transactions
            </div>
            <div class="card-body">
                <div class="row header">

                    <div class="col-lg-6 hash-col">
                        Hash
                    </div>
    
                    <div class="col-lg-1 recipients-col">
                        Recipients
                    </div>
    
                    <div class="col-lg-2 amount-col">
                        Amount (CHC)
                    </div>
                </div>
    
                <div class="rows">
    
                </div>
            </div>
        </div>

       
    </div>
</div>
<script>
     //block details 
     $(function () {

            $(".BlockDetails").on("showArea", function (event, blockId) {
                loadBlock(blockId);
            });


            var blockDetailsEl = $(".BlockDetails");
            var blockHashEl = blockDetailsEl.find(".block-hash");
            var blockJsonLinkEl = blockDetailsEl.find(".block-json-link");
            var blockHeightEl = blockDetailsEl.find(".block-height");
            var blockDifficultyEl = blockDetailsEl.find(".block-difficulty");
            var blockConfirmationsEl = blockDetailsEl.find(".block-confirmations");
            var blockSizeEl = blockDetailsEl.find(".block-size");
            var blockBitsEl = blockDetailsEl.find(".block-bits");
            var blockNonceEl = blockDetailsEl.find(".block-nonce");
            var blockTimestampEl = blockDetailsEl.find(".block-timestamp");
            var blockVersionBitsEl = blockDetailsEl.find(".block-version-bits");

            var transactionListEl = blockDetailsEl.find(".TransactionList");
            var transactionRowTemplateEl = transactionListEl.find(".header").removeClass("header");
            var transactionRowsEl = transactionListEl.find(".rows");

            var loadBlock = function (blockId) {

                blockHashEl.text("");
                blockJsonLinkEl.attr("href","");
                blockHeightEl.text("");
                blockDifficultyEl.text("");
                blockConfirmationsEl.text("");
                blockSizeEl.text("");
                blockBitsEl.text("");
                blockNonceEl.text("");
                blockTimestampEl.text("");
                blockVersionBitsEl.text("");

                transactionRowsEl.empty();

                var request = {
                    op:"getBlock",
                    hash: blockId,
                    extended:true
                }

                sendRequest(request).then(function (block) {
                    blockHashEl.text(block.hash);
                    blockJsonLinkEl.attr("href",chaincoinBlockchainApiUrl + "/getBlock?hash=" + block.hash);
                    blockHeightEl.text(block.height);
                    blockDifficultyEl.text(block.difficulty);
                    blockConfirmationsEl.text(block.confirmations);
                    blockSizeEl.text((block.size/ 1024).toFixed(3));
                    blockBitsEl.text(block.bits);
                    blockNonceEl.text(block.nonce);


                    var versionBits = [];
                    if (((block.version >> 29) & 7) == 1)
                    {
                        for(var bit = 0; bit < 28; bit++)
                        {
                            if ((block.version >> bit) & 1 == 1)
                            {
                                versionBits.push(bit);
                            }
                        }
                    }
                    blockVersionBitsEl.text(versionBits.join(", "));


                    var timestamp = new Date(block.time * 1000);
                    blockTimestampEl.text(timestamp.toLocaleTimeString() + " " + timestamp.toLocaleDateString());


                    for (var i = 0; i < block.tx.length; i++) {

                        var txid = "";
                        var recipients = "";
                        var value = "";

                        if (block.extended)
                        {
                            txid = block.tx[i].txid;
                            recipients = block.tx[i].recipients;
                            value = block.tx[i].value;
                        }
                        else
                        {
                            txid = block.tx[i];
                        }

                        var transationRowEl = transactionRowTemplateEl.clone().appendTo(transactionRowsEl);

                        var anchorEl = $('<a href="#Explorer/Transaction/' + txid + '" />');

                        transationRowEl.find(".hash-col").text("");
                        var hashAnchorEl = anchorEl.clone().appendTo(transationRowEl.find(".hash-col"));
                        hashAnchorEl.text(txid);


                        transationRowEl.find(".recipients-col").text(recipients);

                        transationRowEl.find(".amount-col").text(value);
                    }

                });
            }


        });
</script>


<style>

    .block-json-link{
        float:right;
        font-size: 20px;
    }
    
</style>